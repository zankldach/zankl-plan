{% extends "base.html" %}
{% block title %}Mitarbeiterverwaltung{% endblock %}
{% block content %}

<h1>Mitarbeiterverwaltung – {{ standort }}</h1>

<div id="settings">
    <h3>Mitarbeiterliste</h3>
    <div id="employeeList"></div>
    <button id="addEmployee">+ Mitarbeiter</button>
    <form id="saveForm" method="POST" action="/settings/employees" style="display:none;">
        <input type="hidden" name="standort" value="{{ standort }}">
        <input type="hidden" name="names" id="namesInput">
    </form>
</div>

<script>
const MAX_EMPLOYEES = 15;

// Mitarbeiterliste aus Backend
let employeeNames = {{ employees|tojson }};

// DOM-Referenzen
const employeeListDiv = document.getElementById('employeeList');
const saveForm = document.getElementById('saveForm');
const namesInput = document.getElementById('namesInput');

// Liste rendern
function renderEmployeeList() {
    employeeListDiv.innerHTML = '';
    employeeNames.forEach((name, index) => {
        const div = document.createElement('div');
        div.style.marginBottom = "4px";

        const input = document.createElement('input');
        input.type = "text";
        input.value = name;
        input.style.width = "200px";
        input.oninput = () => {
            employeeNames[index] = input.value;
            saveEmployees();
        };

        const delBtn = document.createElement('button');
        delBtn.type = "button";
        delBtn.innerText = '–';
        delBtn.onclick = () => {
            employeeNames.splice(index,1);
            renderEmployeeList();
            saveEmployees();
        };
        delBtn.style.marginLeft = "4px";

        div.appendChild(input);
        div.appendChild(delBtn);
        employeeListDiv.appendChild(div);
    });
}

// Mitarbeiter hinzufügen
document.getElementById('addEmployee').onclick = () => {
    if(employeeNames.length >= MAX_EMPLOYEES) return;
    employeeNames.push(`Mitarbeiter ${employeeNames.length+1}`);
    renderEmployeeList();
    saveEmployees();
}

// Liste speichern
function saveEmployees() {
    namesInput.value = employeeNames.join(',');
    saveForm.submit();
}

// Initial rendern
renderEmployeeList();
</script>

{% endblock %}
