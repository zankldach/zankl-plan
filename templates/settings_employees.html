{% extends "base.html" %}

{% block title %}Mitarbeiter Einstellungen{% endblock %}

{% block content %}
<h2>Mitarbeiter verwalten</h2>

<ul id="employeeList">
    {% for emp in employees %}
        <li data-index="{{ loop.index0 }}">
            {{ emp }}
            <button class="deleteBtn">❌</button>
        </li>
    {% endfor %}
</ul>

<input type="text" id="newEmployee" placeholder="Neuer Mitarbeiter">
<button id="addEmployee">Hinzufügen</button>
{% endblock %}

{% block scripts %}
<script>
let employees = {% if employees %}{{ employees|tojson }}{% else %}[] {% endif %};

/* ---------- Liste rendern ---------- */
function renderList(){
    const ul = document.getElementById('employeeList');
    ul.innerHTML='';
    employees.forEach((e,i)=>{
        const li = document.createElement('li');
        li.dataset.index=i;
        li.textContent=e + ' ';
        const btn = document.createElement('button');
        btn.textContent='❌';
        btn.onclick=()=>{ employees.splice(i,1); saveEmployees(); renderList(); };
        li.appendChild(btn);
        ul.appendChild(li);
    });
}

/* ---------- Hinzufügen ---------- */
document.getElementById('addEmployee').onclick=()=>{
    const name=document.getElementById('newEmployee').value.trim();
    if(name){ employees.push(name); document.getElementById('newEmployee').value=''; saveEmployees(); renderList(); }
};

/* ---------- Speichern ---------- */
async function saveEmployees(){
    try{
        await fetch('/settings/employees',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({employees})
        });
    }catch(e){ console.warn('Speichern fehlgeschlagen'); }
}

/* ---------- Init ---------- */
renderList();
</script>
{% endblock %}
