{% extends "base.html" %}
{% block title %}Einstellungen · Mitarbeiter{% endblock %}

{% block content %}
<h1>Einstellungen · Mitarbeiter</h1>

<!-- Standortwechsel -->
<form id="standortForm" method="get" action="/settings/employees" style="margin-bottom:12px;">
  <label>
    Standort:
    <select name="standort" onchange="this.form.submit()">
      <option value="engelbrechts" {{ 'selected' if standort=='engelbrechts' else '' }}>Engelbrechts</option>
      <option value="gross-gerungs" {{ 'selected' if standort=='gross-gerungs' else '' }}>Groß Gerungs</option>
    </select>
  </label>
</form>

{% if saved %}
<div style="padding:8px; background:#e8ffe8; border:1px solid #9bd49b; margin-bottom:10px;">
  Gespeichert.
</div>
{% endif %}

<!-- Bestehende Mitarbeiter -->
<table class="table" style="margin-bottom:14px;">
  <thead>
    <tr>
      <th style="width:80px; text-align:left;">ID</th>
      <th style="text-align:left;">Name</th>
    </tr>
  </thead>
  <tbody>
    {% for e in employees or [] %}
    <tr>
      <td style="text-align:left;">{{ e.id }}</td>
      <td style="text-align:left;">
        <input type="text" value="{{ e.name }}" disabled
               style="width:100%; background:#f8fafc;">
      </td>
    </tr>
    {% endfor %}
    {% if not employees or employees|length == 0 %}
    <tr>
      <td colspan="2" style="text-align:left; color:#64748b;">
        Noch keine Mitarbeiter für diesen Standort erfasst.
      </td>
    </tr>
    {% endif %}
  </tbody>
</table>

<!-- NEUE Mitarbeiter -->
<form id="empForm" method="post" action="/settings/employees">
  <input type="hidden" name="standort" value="{{ standort }}">

  <fieldset style="border:1px solid #e5e7eb; padding:10px; border-radius:6px;">
    <legend style="padding:0 6px; font-weight:600;">Neue Mitarbeiter</legend>

    <div id="newInputs" style="display:flex; flex-direction:column; gap:8px;"></div>

    <div style="margin-top:10px; display:flex; gap:8px;">
      <button type="button" id="addBtn">+ Zeile</button>
      <button type="submit">Speichern</button>
    </div>
  </fieldset>
</form>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const wrap = document.getElementById('newInputs');
  const addBtn = document.getElementById('addBtn');

  function makeRow() {
    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.gap = '6px';

    row.innerHTML = `
      <input type="text" name="emp_name_new[]" placeholder="Name eingeben"
             style="flex:1; padding:6px;">
      <button type="button">✕</button>
    `;

    const btn = row.querySelector('button');
    btn.addEventListener('click', () => {
      if (wrap.children.length > 1) row.remove();
      ensureTrailingEmpty();
    });

    row.querySelector('input').addEventListener('input', ensureTrailingEmpty);
    return row;
  }

  function ensureTrailingEmpty() {
    const inputs = wrap.querySelectorAll('input[name="emp_name_new[]"]');
    if (inputs.length === 0 || inputs[inputs.length - 1].value.trim() !== '') {
      wrap.appendChild(makeRow());
    }
  }

  addBtn.addEventListener('click', () => {
    wrap.appendChild(makeRow());
  });

  ensureTrailingEmpty();
});
</script>
{% endblock %}
