
{% extends "base.html" %}
{% block title %}Mitarbeiter – Zankl Plan{% endblock %}

{% block content %}
<h2>Mitarbeiter verwalten</h2>

<p>Hier kannst du Mitarbeiter für die Standorte <strong>Engelbrechts</strong> und <strong>Groß Gerungs</strong> pflegen. Speichern sendet die Liste an den Server und ersetzt die bestehenden Einträge.</p>

<div style="display:flex; gap:24px; flex-wrap:wrap;">
  <section style="flex:1; min-width:320px;">
    <h3>Engelbrechts</h3>
    <table id="tbl-engelbrechts">
      <thead><tr><th>Name</th><th>Aktion</th></tr></thead>
      <tbody>
        {% for e in employees if e.standort == 'engelbrechts' %}
          <tr>
            <td><input type="text" value="{{ e.name }}"></td>
            <td><button class="btn-del">Löschen</button></td>
          </tr>
        {% endfor %}
        {% if employees|length == 0 %}
          <tr><td><input type="text" value=""></td><td><button class="btn-del">Löschen</button></td></tr>
        {% endif %}
      </tbody>
    </table>
    <button id="add-eng">+ Zeile</button>
  </section>

  <section style="flex:1; min-width:320px;">
    <h3>Groß Gerungs</h3>
    <table id="tbl-gross">
      <thead><tr><th>Name</th><th>Aktion</th></tr></thead>
      <tbody>
        {% for e in employees if e.standort == 'gross-gerungs' %}
          <tr>
            <td><input type="text" value="{{ e.name }}"></td>
            <td><button class="btn-del">Löschen</button></td>
          </tr>
        {% endfor %}
        {% if employees|length == 0 %}
          <tr><td><input type="text" value=""></td><td><button class="btn-del">Löschen</button></td></tr>
        {% endif %}
      </tbody>
    </table>
    <button id="add-gross">+ Zeile</button>
  </section>
</div>

<div style="margin-top:16px;">
  <button id="saveEmp">Speichern</button>
</div>
{% endblock %}

{% block scripts %}
<script>
function addRow(tblId) {
  const tbody = document.querySelector(`#${tblId} tbody`);
  const tr = document.createElement('tr');
  tr.innerHTML = `<td><input type="text" value=""></td><td><button class="btn-del">Löschen</button></td>`;
  tbody.appendChild(tr);
}

document.getElementById('add-eng').onclick = () => addRow('tbl-engelbrechts');
document.getElementById('add-gross').onclick = () => addRow('tbl-gross');

document.addEventListener('click', (e) => {
  if (e.target.classList.contains('btn-del')) {
    const tr = e.target.closest('tr');
    tr?.parentElement?.removeChild(tr);
  }
});

document.getElementById('saveEmp').onclick = () => {
  const employees = [];

  document.querySelectorAll('#tbl-engelbrechts tbody tr').forEach(tr => {
    const name = tr.querySelector('input').value.trim();
    if (name) employees.push({ name, standort: 'engelbrechts' });
  });

  document.querySelectorAll('#tbl-gross tbody tr').forEach(tr => {
    const name = tr.querySelector('input').value.trim();
    if (name) employees.push({ name, standort: 'gross-gerungs' });
  });

  fetch('/settings/employees', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ employees })
  })
  .then(res => res.json())
  .then(r => {
    if (r.ok) alert('Gespeichert.');
    else alert('Fehler: ' + (r.error || 'unbekannt'));
  })
  .catch(e => alert('Fehler: ' + e));
};
</script>
{% endblock %}
``
