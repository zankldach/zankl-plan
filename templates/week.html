<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wochenplanung Zankl Dach</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
header { background:#003a8f; color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
nav { display:flex; gap:15px; }
nav a { color:white; text-decoration:none; font-weight:bold; }
section { padding:20px; }
h2 { margin-top:0; }
table { width:100%; border-collapse:collapse; background:white; margin-bottom:20px; }
th, td { border:1px solid #ddd; padding:6px; text-align:center; }
th { background:#eef2f6; }
td input { width:100%; padding:4px; box-sizing:border-box; }
button { padding:6px 12px; margin:4px 0; cursor:pointer; background:#003a8f; color:white; border:none; }
button:hover { opacity:0.9; }

/* Einfaches responsive Menü */
@media(max-width:600px){
    nav { flex-direction:column; gap:5px; }
}
</style>
</head>
<body>

<header>
    <strong>Zankl Dach – Wochenplanung</strong>
    <nav>
        <a href="/week?standort=engelbrechts">Engelbrechts</a>
        <a href="/week?standort=gross-gerungs">Groß Gerungs</a>
        <a href="/settings/employees">Mitarbeiter</a>
    </nav>
</header>

<section>
<h2>Wochenplanung – Standort: <span id="locLabel">{{ standort }}</span></h2>

<table id="weekTable">
<thead>
<tr>
    <th>Mitarbeiter</th>
    {% for day in days %}
    <th>{{ day.label }}<br>{{ day.date }}</th>
    {% endfor %}
</tr>
</thead>
<tbody>
{% for r in range(grid|length) %}
<tr>
    <td><input type="text" value="" data-row="{{ r }}" data-day="-1"></td>
    {% for d in range(5) %}
    <td><input type="text" value="{{ grid[r][d].text }}" data-row="{{ r }}" data-day="{{ d }}"></td>
    {% endfor %}
</tr>
{% endfor %}
</tbody>
</table>

<button id="saveBtn">Änderungen speichern</button>
</section>

<script>
let changes = [];

document.querySelectorAll('#weekTable input').forEach(input => {
    input.addEventListener('input', () => {
        const row = parseInt(input.dataset.row);
        const day = parseInt(input.dataset.day);
        const value = input.value;
        const idx = changes.findIndex(c => c.row===row && c.day===day);
        if(idx>=0) changes[idx].value = value;
        else changes.push({row, day, value});
    });
});

document.getElementById('saveBtn').onclick = async () => {
    if(changes.length===0) return alert('Keine Änderungen zum Speichern.');
    const res = await fetch('/api/week/set-cell', {
        method:'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
            year: {{ year }},
            kw: {{ kw }},
            standort: "{{ standort }}",
            changes: changes
        })
    });
    const data = await res.json();
    if(data.ok){
        alert('Änderungen gespeichert!');
        changes = [];
    } else alert('Fehler beim Speichern.');
};
</script>

</body>
</html>
