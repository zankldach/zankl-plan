<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wochenplanung Zankl Dach</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
header { background:#003a8f; color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
nav { display:flex; gap:15px; }
nav a { color:white; text-decoration:none; font-weight:bold; }
section { padding:20px; }
h2 { margin-top:0; }
table { width:100%; border-collapse:collapse; background:white; margin-bottom:20px; }
th, td { border:1px solid #ddd; padding:6px; text-align:center; }
th { background:#eef2f6; }
td input { width:100%; padding:4px; box-sizing:border-box; }
button { padding:4px 8px; margin-left:4px; cursor:pointer; }

/* Einfaches responsive Menü */
@media(max-width:600px){
    nav { flex-direction:column; gap:5px; }
}
</style>
</head>
<body>

<header>
    <strong>Zankl Dach – Wochenplanung</strong>
    <nav>
        <a href="/week?standort=engelbrechts">Wochenplanung Engelbrechts</a>
        <a href="/week?standort=gross-gerungs">Wochenplanung Groß Gerungs</a>
        <a href="/settings/employees">Mitarbeiter</a>
    </nav>
</header>

<section>
<h2>Wochenplanung {{ kw }}/{{ year }}</h2>

<label for="locationSelect">Standort:</label>
<select id="locationSelect">
    <option value="engelbrechts" {% if location=='engelbrechts' %}selected{% endif %}>Engelbrechts</option>
    <option value="gross-gerungs" {% if location=='gross-gerungs' %}selected{% endif %}>Groß Gerungs</option>
</select>

<table id="weekTable">
<thead>
<tr>
    <th>Mitarbeiter</th>
    {% for day in days %}
    <th>{{ day.label }}<br>{{ day.date }}</th>
    {% endfor %}
</tr>
</thead>
<tbody>
{% for i, row in enumerate(grid) %}
<tr>
    <td>
        {% if employees|length > i %}
        {{ employees[i] }}
        {% else %}
        -
        {% endif %}
    </td>
    {% for cell in row %}
    <td><input type="text" value="{{ cell.text }}" data-row="{{ loop.parent.index0 }}" data-day="{{ loop.index0 }}"></td>
    {% endfor %}
</tr>
{% endfor %}
</tbody>
</table>

</section>

<script>
const locationSelect = document.getElementById('locationSelect');
locationSelect.onchange = () => {
    const loc = locationSelect.value;
    const params = new URLSearchParams(window.location.search);
    params.set('standort', loc);
    window.location.search = params.toString();
};

// Save on blur
document.querySelectorAll('#weekTable input').forEach(input => {
    input.addEventListener('blur', async () => {
        const row = input.dataset.row;
        const day = input.dataset.day;
        const value = input.value;
        const res = await fetch('/api/week/set-cell', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                year: {{ year }},
                kw: {{ kw }},
                row: parseInt(row),
                day: parseInt(day),
                value: value,
                location: locationSelect.value
            })
        });
        const data = await res.json();
        if(!data.ok) alert('Fehler beim Speichern');
    });
});
</script>

</body>
</html>
